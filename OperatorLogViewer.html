<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Operator Log viewer</title>
    <style>
      body {
        font: 100%/1.4 Verdana, Arial, Helvetica, sans-serif;
        background: #42413c;
        margin: 0;
        padding: 0;
        color: #3f3f3f;
      }

      tr {
        display: flex;
      }

      th,
      td {
        flex: 1;
        border: 1px solid rgb(18, 18, 18);
        padding: 8px;
        text-align: left;
      }

      .button {
        height: 26px;
        display: inline-block;
        outline: none;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        text-shadow: 1px 1px #000;
        -webkit-border-radius: 5px;
        -webkit-box-shadow: inset 0px 0px 0px 1px rgba(78, 78, 78, 1);
        background-color: #3b3b3b;
        border: 1px outset #333;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        font-weight: bold;
        line-height: 100%;
        color: #fff;
        padding: 5px 10px;
        margin-right: 10px;
      }

      button.active {
        background-color: rgba(204, 158, 158, 0.534);
        color: rgb(161, 159, 159);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background-color: #f2f2f2;
        position: sticky;
        top: 0;
        z-index: 1;
      }

      .sticky-header {
        position: sticky;
        top: 0;
        background-color: #f2f2f2;
        z-index: 1;
      }
      .hide-buttons {
        border: 2px solid grey;
        padding: 10px;
        margin: 10px;
        text-align: center;
      }

      .hide-buttons button {
        text-align: center;
      }
      .action1 {
        background-color: lightblue;
      }

      .action2 {
        background-color: lightgreen;
      }

      .action3 {
        background-color: #e6e6e6;
      }

      .action4 {
        background-color: #ca7029;
      }

      .action5 {
        background-color: rgb(139, 139, 139);
      }

      .action6 {
        background-color: #d19d75;
      }

      .lockList {
        background-color: lightsteelblue;
      }

      .unlockList {
        background-color: lightgoldenrodyellow;
      }
      .Insert_before_Primary {
        background-color: rgb(234, 240, 157);
      }
      .button-container {
        display: flex;
        align-items: center;
      }

      .button-container input,
      .button-container button {
        margin-right: 10px;
      }

      .button {
        background-color: #4caf50; /* Зеленый цвет кнопки */
        border: none;
        color: white;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 10px;
        cursor: pointer;
      }

      .button:hover {
        background-color: #45a049; /* Цвет кнопки при наведении курсора */
      }
      #fileInput,
      button,
      #result {
        border: 1px solid #ccc;
        border-radius: 3px;
        padding: 5px 10px;
        margin: 5px;
      }

      button {
        cursor: pointer;
      }

      #result {
        display: none;
      }
      #discription {
        color: #e8e8e8;
        margin: 10px;
      }
      .divdiscription {
        border: 2px solid grey; /* Рамка шириной 2 пикселя и серого цвета */
        display: inline-block; /* Для автоматического определения ширины */
        padding: 10px; /* Добавление отступа внутри блока */
        margin: 10px;
        background-color: #d19d75;
      }
      .operlog {
        padding: 10px;
        margin: 10px;
    
      }
    </style>
  </head>
  <body>
    <div id="result" style="display: none"></div>

    <div class="divdiscription">
      <p id="discription">Выберете файл OperatorLog</p>
      <input type="file" id="fileInput" accept=".log" /><br />
      <button onclick="processFile()">Convert to JSON</button>
      <p id="discription">Конвертируйте файл в JSON</p>

      <button onclick="saveProcessedData()">Save JSON</button>
      <p id="discription">Сохраните конвертируемый файл в JSON формате</p>
    </div>
    <div class="hide-buttons">
      <button onclick="toggleVisibility('action1')">Hide AppendList</button>
      <button onclick="toggleVisibility('action2')">
        Hide Toggle_hard_start
      </button>
      <button onclick="toggleVisibility('action3')">
        Hide Del_/_Cut_Primary
      </button>
      <button onclick="toggleVisibility('action4')">
        Hide Del_/_Cut_Secondary
      </button>
      <button onclick="toggleVisibility('action5')">Hide Copy_Primary</button>
      <button onclick="toggleVisibility('action6')">Hide Copy_Secondary</button>
      <button onclick="toggleVisibility('lockList')">Hide Lock_List</button>
      <button onclick="toggleVisibility('unlockList')">Hide Unlock_List</button>
      <button onclick="toggleVisibility('Insert_before_Primary')">
        Hide Insert_before_Primary
      </button>
      <button onclick="hideAll()">Hide All</button>
    </div>
   
    <h1>Operator Log</h1>
   
    <div class="operlog">
    <p id="discription">Добавьте JSON файл</p>
    <input type="file" id="fileInput1" accept=".json" />
    <button class="button" onclick="handleFile()">Show Log!</button>
    <p id="discription">Нажмите Show Log! для отображения </p>
    <input type="text" id="searchInput" placeholder="Search text..." />
    <button class="button" onclick="searchText()">Search</button>
</div>
</div>
    <table id="dataTable">
      <thead class="sticky-header">
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Server</th>
          <th>List</th>
          <th>Action</th>
          <th>pl_Time</th>
          <th>pr_id</th>
          <th>WP</th>
          <th>title</th>
        </tr>
      </thead>
      <tbody id="dataBody"></tbody>
    </table>

    <script>
      function hideAll() {
        toggleVisibility("action1");
        toggleVisibility("action2");
        toggleVisibility("action3");
        toggleVisibility("action4");
        toggleVisibility("action5");
        toggleVisibility("action6");
        toggleVisibility("lockList");
        toggleVisibility("unlockList");
        toggleVisibility("Insert_before_Primary");
      }
      function searchText() {
        const searchValue = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#dataBody tr");

        rows.forEach((row) => {
          let found = false;
          row.childNodes.forEach((cell) => {
            if (cell.textContent.toLowerCase().includes(searchValue)) {
              found = true;
            }
          });

          if (found) {
            row.style.display = "table-row";
          } else {
            row.style.display = "none";
          }
        });

        // Handle the visibility and width of the table header separately
        const tableHeader = document.querySelector(".sticky-header");
        const visibleRows = document.querySelectorAll(
          "#dataBody tr[style='display: table-row;']"
        );
        if (visibleRows.length > 0) {
          tableHeader.style.display = "table-row";
          tableHeader.style.width = "100%";
        } else {
          tableHeader.style.display = "none";
        }
      }

      function toggleVisibility(actionClass) {
        const rows = document.getElementsByClassName(actionClass);
        for (let i = 0; i < rows.length; i++) {
          if (rows[i].style.display === "none") {
            rows[i].style.display = "table-row";
          } else {
            rows[i].style.display = "none";
          }
        }

        const button = document.querySelector(
          `button[onclick="toggleVisibility('${actionClass}')"]`
        );
        button.classList.toggle("active");
      }

      function handleFile() {
        const fileInput1 = document.getElementById("fileInput1");
        const file = fileInput1.files[0];

        const reader = new FileReader();
        reader.onload = function (e) {
          const jsonData = JSON.parse(e.target.result);
          const tableBody = document.getElementById("dataBody");
          tableBody.innerHTML = "";

          jsonData.forEach((event) => {
            const row = document.createElement("tr");
            const keys = [
              "Date",
              "Time",
              "Server",
              "List",
              "Action",
              "pl_Time",
              "pr_id",
              "WP",
              "title",
            ];

            keys.forEach((key) => {
              const cell = document.createElement("td");
              cell.textContent = event[key] || "";
              cell.setAttribute("data-key", key);
              cell.setAttribute("data-value", event[key] || "");

              switch (event.Action) {
                case "AppendList":
                  cell.classList.add("action1");
                  break;
                case "Toggle_hard_start":
                  cell.classList.add("action2");
                  break;
                case "Del_/_Cut_Primary":
                  cell.classList.add("action3");
                  break;
                case "Del_/_Cut_Secondary":
                  cell.classList.add("action4");
                  break;
                case "Copy_Primary":
                  cell.classList.add("action5");
                  break;
                case "Copy_Secondary":
                  cell.classList.add("action6");
                  break;
                case "Lock_List":
                  cell.classList.add("lockList");
                  break;
                case "Unlock_List":
                  cell.classList.add("unlockList");
                  break;
                case "Insert_before_Primary":
                  cell.classList.add("Insert_before_Primary");
                  break;
                default:
                  break;
              }

              row.appendChild(cell);
            });

            tableBody.appendChild(row);
          });
        };

        reader.readAsText(file);
      }
    </script>
    <script>
      let processedData = [];

      function processFile() {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = function (event) {
          const fileContent = event.target.result;
          const lines = fileContent.split("\n");

          processedData = [];
          // Del_/_Cut_Primary
          lines.forEach((line) => {
            if (line.includes("Del_/_Cut_Primary")) {
              const cleanedLine = line.replace(/[\x00-\x1F\x7F-\x9F]/g, "");
              const del_prim = cleanedLine.split(
                / |_-_|_:_|:_|_-_|_#_|:_'|e:_'|',_ID:_'|',_Title:'|Playlist_on_/
              );

              //console.log(del_prim);
              del_prim[29] = del_prim[29].replace("Title:'", ""); // add
              del_prim[29] = del_prim[29].replace("'_", ""); // add
              let date = del_prim[0];
              let time = del_prim[1];
              let server = del_prim[23];
              let list = del_prim[24];
              let action = del_prim[25];
              let pl_Time = del_prim[27];
              let pr_id = del_prim[28];
              let wp = del_prim[33];
              let title =
                del_prim[30] + " " + del_prim[31] + "\n" + del_prim[32];
              let substringToRemove = "List:_";
              let server2 = server.replace(substringToRemove, "");
              let found = false;

              if (
                typeof del_prim[33] !== "string" ||
                !del_prim[33].includes("WP")
              ) {
                del_prim.forEach(function (fruit, index) {
                  if (
                    index !== 33 &&
                    typeof fruit === "string" &&
                    fruit.includes("WP")
                  ) {
                    del_prim[33] = fruit;
                    found = true;
                  }
                });
              }

              if (!found) {
                // console.log("Текст WP не найден в других элементах массива.");
              }

              const json = {
                Date: del_prim[0],
                Time: del_prim[1],
                Action: del_prim[26],
                pr_id: del_prim[29],
                Server: del_prim[24],
                List: del_prim[25],
                pl_Time: del_prim[28],
                WP: del_prim[33],
                title: title,
              };

              processedData.push(json);
            }
            // Del_/_Cut_Secondary
            else if (line.includes("Del_/_Cut_Secondary")) {
              const cleanedLine = line.replace(/[\x00-\x1F\x7F-\x9F]/g, "");
              const del_secondary = cleanedLine.split(
                / |_-_|_:_|_#_|_'|',_ID:_'|',_|Playlist_on_/
              );
              if (
                typeof del_secondary[39] === "undefined" ||
                !del_secondary[39].includes(" WP")
              ) {
                del_secondary[39] = del_secondary[41];
              }
              del_secondary[29] = del_secondary[29].replace("Title:'", ""); // add
              del_secondary[29] = del_secondary[29].replace("'_", ""); // add
              let server = del_secondary[23].replace("List:_", "");
              //console.log(del_secondary);
              const json = {
                Date: del_secondary[0],
                Time: del_secondary[1],
                Server: server,
                List: del_secondary[24],
                Action: del_secondary[25],
                pl_Time: del_secondary[27],
                pr_id: del_secondary[28],
                WP: del_secondary[39],
                title: del_secondary[29],
              };
              processedData.push(json);
              //Toggle_hard_start
            } else if (line.includes("Toggle_hard_start")) {
              const cleanedLine = line.replace(/[\x00-\x1F\x7F-\x9F]/g, "");
              const hd_strt = cleanedLine.split(
                / | - | |_in_| - |',_ID:_'|,_|Playlist_on_/
              );

              let date = hd_strt[0];
              let time = hd_strt[1];
              let server = hd_strt[19];
              let list = hd_strt[21];
              let action = hd_strt[18];
              let pr_id = hd_strt[22];
              let wp = hd_strt[24];
              let title = hd_strt[26];

              const json = {
                Date: date,
                Time: time,
                Server: server,
                List: list,
                Action: action,
                pr_id: pr_id,
                WP: wp,
                title: hd_strt[26],
              };
              processedData.push(json);
              // AppendList
            } else if (line.includes("AppendList")) {
              const cleanedline = line.replace(/[\x00-\x1F\x7F-\x9F]/g, ""); //
              const App_List = cleanedline.split(
                / |_-_|_:_|_#_|lst_in_|',_ID:_'|',_|Playlist_on_/
              );
              JSON.stringify(App_List);
              //console.log(App_List);

              let date = App_List[0];
              let time = App_List[1];
              let server = App_List[28];
              let list = App_List[29];
              let action = App_List[25];
              let wp = App_List[31];

              let substringToRemove = "List:_";
              let server2 = server.replace(substringToRemove, "");

              // console.log(
              // App_List[0],
              // App_List[1],
              // App_List[23],
              // App_List[24],
              // App_List[26],
              // App_List[27],
              // App_List[28],
              //  App_List[31]
              // );
              const json = {
                Date: App_List[0],
                Time: App_List[1],
                Server: App_List[28],
                List: App_List[29],
                Action: App_List[26],
                WP: App_List[31],
              };

              processedData.push(json);
              // Copy_Secondary
            } else if (line.includes("Copy_Secondary")) {
              const cleanedLine = line.replace(/[\x00-\x1F\x7F-\x9F]/g, "");
              const Copy_Sec = cleanedLine.split(
                / |_-_|_:_|:_|_-_|_#_|:_'|e:_'|',_ID:_'|',_Title:'|Playlist_on_/
              );

              console.log(Copy_Sec);
              Copy_Sec[29] = Copy_Sec[29].replace("Title:'", ""); // add
              Copy_Sec[29] = Copy_Sec[29].replace("'_", ""); // add
              let date = Copy_Sec[0];
              let time = Copy_Sec[1];
              let server = Copy_Sec[23];
              let list = Copy_Sec[24];
              let action = Copy_Sec[25];
              let pl_Time = Copy_Sec[27];
              let pr_id = Copy_Sec[28];
              let wp = Copy_Sec[33];
              let title =
                Copy_Sec[30] + " " + Copy_Sec[31] + "\n" + Copy_Sec[32];
              let substringToRemove = "List:_";
              let server2 = server.replace(substringToRemove, "");
              let found = false;

              if (
                typeof Copy_Sec[33] !== "string" ||
                !Copy_Sec[33].includes("WP")
              ) {
                Copy_Sec.forEach(function (fruit, index) {
                  if (
                    index !== 33 &&
                    typeof fruit === "string" &&
                    fruit.includes("WP")
                  ) {
                    Copy_Sec[33] = fruit;
                    found = true;
                  }
                });
              }

              //if (!found) {
              // console.log("Текст WP не найден в других элементах массива.");
              //}

              const json = {
                Date: Copy_Sec[0],
                Time: Copy_Sec[1],
                Action: Copy_Sec[26],
                pr_id: Copy_Sec[29],
                Server: Copy_Sec[24],
                List: Copy_Sec[25],
                pl_Time: Copy_Sec[28],
                WP: Copy_Sec[33],
                title: title,
              };

              processedData.push(json);
            }
            // Copy_Primary
            else if (line.includes("Copy_Primary")) {
              const cleanedLine = line.replace(/[\x00-\x1F\x7F-\x9F]/g, "");
              const Copy_Prim = cleanedLine.split(
                / |_-_|_:_|_#_|_'|',_ID:_'|',_|Playlist_on_/
              );
              if (
                typeof Copy_Prim[35] !== "string" ||
                !Copy_Prim[35].includes("WP")
              ) {
                Copy_Prim.forEach(function (fruit, index) {
                  if (
                    index !== 35 &&
                    typeof fruit === "string" &&
                    fruit.includes("WP")
                  ) {
                    Copy_Prim[35] = fruit;
                    found = true;
                  }
                });
              }

              Copy_Prim[29] = Copy_Prim[29].replace("Title:'", ""); // add
              Copy_Prim[29] = Copy_Prim[29].replace("'_", ""); // add
              let server = Copy_Prim[23].replace("List:_", "");
              console.log(Copy_Prim);
              const json = {
                Date: Copy_Prim[0],
                Time: Copy_Prim[1],
                Server: server,
                List: Copy_Prim[24],
                Action: Copy_Prim[25],
                pl_Time: Copy_Prim[27],
                pr_id: Copy_Prim[28],
                WP: Copy_Prim[35],
                title:
                  Copy_Prim[29] +
                  " " +
                  Copy_Prim[30] +
                  "" +
                  Copy_Prim[31] +
                  "\n" +
                  Copy_Prim[32] +
                  "" +
                  Copy_Prim[33],
              };
              processedData.push(json);
            } else if (line.includes("Lock_List")) {
              const cleanedline = line.replace(/[\x00-\x1F\x7F-\x9F]/g, ""); //
              const Lk_Lst = cleanedline.split(
                / |_-_|_:_|t:_#_|ts|',_ID:_'|:_|',_|Playlist_on_/
              );
              JSON.stringify(Lk_Lst);
              //console.log(Lk_Lst);

              let date = Lk_Lst[0];
              let time = Lk_Lst[1];
              let server = Lk_Lst[23];
              let list = Lk_Lst[24];
              let action = Lk_Lst[25];
              let pl_Time = Lk_Lst[27];
              let pr_id = Lk_Lst[28];
              let wp = Lk_Lst[31];

              // let substringToRemove = "List:_";
              // let server2 = server.replace(substringToRemove, "");

              // console.log(
              //Lk_Lst[0],
              // Lk_Lst[1],
              // Lk_Lst[23],
              //Lk_Lst[24],
              // Lk_Lst[25],
              // Lk_Lst[27],
              // Lk_Lst[28],
              // Lk_Lst[31]
              // );
              const json = {
                Date: Lk_Lst[0],
                Time: Lk_Lst[1],
                Server: Lk_Lst[24],
                List: Lk_Lst[25],
                Action: Lk_Lst[23],
                // pl_Time: Lk_Lst[27],
                pr_id: Lk_Lst[28],
                WP: Lk_Lst[27],
              };

              processedData.push(json);
              //Unlock_List
            } else if (line.includes("Unlock_List")) {
              const cleanedline = line.replace(/[\x00-\x1F\x7F-\x9F]/g, ""); //
              const Unlk_List = cleanedline.split(
                / |_-_|_:_|t:_#_|ts|',_ID:_'|:_|',_|Playlist_on_/
              );
              JSON.stringify(Unlk_List);
              //console.log(Unlk_List);

              let date = Unlk_List[0];
              let time = Unlk_List[1];
              let server = Unlk_List[23];
              let list = Unlk_List[24];
              let action = Unlk_List[25];
              let pl_Time = Unlk_List[27];
              let pr_id = Unlk_List[28];
              let wp = Unlk_List[31];

              // let substringToRemove = "List:_";
              // let server2 = server.replace(substringToRemove, "");

              // console.log(
              //  Unlk_List[0],
              //Unlk_List[1],
              // Unlk_List[23],
              // Unlk_List[24],
              //  Unlk_List[25],
              // Unlk_List[27],
              // Unlk_List[28],
              // Unlk_List[31]
              //);
              const json = {
                Date: Unlk_List[0],
                Time: Unlk_List[1],
                Server: Unlk_List[24],
                List: Unlk_List[25],
                Action: Unlk_List[23],
                // pl_Time: Unlk_List[27],
                pr_id: Unlk_List[28],
                WP: Unlk_List[27],
              };

              processedData.push(json);
            } //Insert_before
            else if (line.includes("Insert_before")) {
              const cleanedline = line.replace(/[\x00-\x1F\x7F-\x9F]/g, ""); //
              const Inst_bfre = cleanedline.split(
                / |_-_|_:_|t:_#_|ts|',_ID:_'|_#_|:_|',_|ls:_|Playlist_on_/
              );

              JSON.stringify(Inst_bfre);
              // console.log(Inst_bfre);

              let date = Inst_bfre[0];
              let time = Inst_bfre[1];
              let server = Inst_bfre[23];
              let list = Inst_bfre[24];
              let action = Inst_bfre[26];
              let pl_Time = Inst_bfre[27];
              let pr_id = Inst_bfre[28];
              let wp = Inst_bfre[36];
              let title = Inst_bfre[34];
              // let substringToRemove = "List:_";
              // let server2 = server.replace(substringToRemove, "");

              //  console.log(
              // Inst_bfre[0],
              //  Inst_bfre[1],
              //   Inst_bfre[23],
              //  Inst_bfre[24],
              //  Inst_bfre[25],
              //  Inst_bfre[26],
              // Inst_bfre[27],
              // Inst_bfre[28],
              //  Inst_bfre[36],
              //  Inst_bfre[34]
              // );
              const json = {
                Date: Inst_bfre[0],
                Time: Inst_bfre[1],
                Server: Inst_bfre[24],
                List: Inst_bfre[25],
                Action: Inst_bfre[26],
                pl_Time: Inst_bfre[27],
                //pr_id: Inst_bfre[28],
                title: Inst_bfre[34],
                WP: Inst_bfre[36],
              };

              processedData.push(json);
            }
          });
        };

        reader.readAsText(file, "windows-1251");
      }

      function saveProcessedData() {
        const dataToSave = JSON.stringify(processedData, null, 2);
        const blob = new Blob([dataToSave], {
          type: "application/json; charset=windows-1251",
        });

        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "обработанные_данные.json";
        a.click();
      }
    </script>
  </body>
</html>
